- name: Bootstrap machine
  hosts: localhost

  tasks:
    # BASE
    #

    # clear pacman cache automatically every week
    - name: Install pacman-contrib
      kewlfft.aur.aur:
        name: pacman-contrib
        state: latest
    - name: Enable paccache.timer
      ansible.builtin.systemd:
        name: paccache.timer
        enabled: true
        masked: no

    # TODO: configure Meslo NF as default in kitty - https://github.com/romkatv/powerlevel10k#manual-font-installation
    - name: "Install font: Meslo (Nerd Font variant)"
      kewlfft.aur.aur:
        name: ttf-meslo-nerd
        state: latest

    # setup chezmoi
    - name: Install chezmoi
      community.general.pacman:
        name: chezmoi
        state: latest
    - name: Init chezmoi
      ansible.builtin.command:
        cmd: chezmoi init --apply https://github.com/SandroHc/sandro-dotfiles.git
        creates: "~/.local/share/chezmoi"

    # TODO: install paru
    # TODO: setup SSH and GPG keys
    # TODO: increase GPG agent timeouts


    # QOL
    #

    # setup QoL tools
    - name: Install QoL tools
      become: yes
      community.general.pacman:
        name:
          - bat        # `cat` alternative
          - difftastic # `diff` alternative
          - eza        # `ls` alternative
          - fd         # `find` alternative
          - fzf        # fuzzy file search
          - hexyl      # hex viewer
          - neovim
          - oha        # HTTP load generator
          - ripgrep    # `grep` alternative
          - tealdeer   # tldr of man pages
          - zoxide     # `cd` alternative
        state: latest
    - name: Install QoL tools (AUR)
      kewlfft.aur.aur:
        name:
          - jql        # JSON query
        state: latest

    # CLI
    #
    - name: Install Zsh
      community.general.pacman:
        name: zsh
        state: latest
    - name: Set Zsh as default
      become: yes
      ansible.builtin.user:
        name: "{{ansible_user_id}}"
        shell: "/usr/bin/zsh"


    # DE
    #
    - name: Install Wayland apps
      community.general.pacman:
        name:
          - hyprland
          - kitty        # terminal
          - dunst        # notification daemon
          - xdg-desktop-portal-hyprland
          - xdg-desktop-portal-gtk
          - polkit-gnome # auth agent
          - qt5-wayland
          - qt6-wayland
        state: latest
    - name: Install Wayland apps (AUR)
      kewlfft.aur.aur:
        name:
          - eww-wayland  # status bar, widgets
          - rofi-lbonn-wayland-git # app launcher
          - swww         # wallpaper
        state: latest
    - name: Install screensharing apps
      community.general.pacman:
        name:
          - pipewire
          - wireplumber
          - grim
          - slurp
        state: latest


    # DEVEL
    #
    - name: Install packages for development
      become: yes
      community.general.pacman:
        name:
          - base-devel
          - jdk-openjdk
          - python
          - nodejs
        state: latest
    - name: Install jetbrains-toolbox
      kewlfft.aur.aur:
        name: jetbrains-toolbox
        state: latest
